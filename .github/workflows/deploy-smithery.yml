name: Deploy to Smithery

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: Run tests
      run: |
        python -c "import server; print('âœ… Server import baÅŸarÄ±lÄ±')"
        
    - name: Build Docker image
      run: |
        docker build -t jama-abstract-generator .
        
    - name: Test Docker image
      run: |
        docker run --rm jama-abstract-generator python -c "import server; print('âœ… Docker container test baÅŸarÄ±lÄ±')"
        
    - name: Deploy to Smithery
      env:
        SMITHERY_API_KEY: ${{ secrets.SMITHERY_API_KEY }}
      run: |
        echo "ğŸš€ Smithery.ai'ye deployment baÅŸlÄ±yor..."
        echo "ğŸ“‹ Deployment sonrasÄ±:"
        echo "   1. https://smithery.ai adresine gidin"
        echo "   2. GitHub ile giriÅŸ yapÄ±n"
        echo "   3. 'New Project' oluÅŸturun"
        echo "   4. Repository: aliemregencer/jama-abstract-mcp-v3"
        echo "   5. Branch: main"
        echo "   6. Deploy butonuna tÄ±klayÄ±n"
        
    - name: Verify deployment
      run: |
        echo "âœ… Build ve test tamamlandÄ±!"
        echo "ğŸ”— Smithery.ai'de manuel deployment yapÄ±n:"
        echo "   https://smithery.ai"
